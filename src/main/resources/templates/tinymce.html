<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <script src="/webjars/tinymce/5.10.7/tinymce.js"></script>
    <script src="/webjars/tinymce/5.10.7/jquery.tinymce.min.js"></script>

</head>

<body>
<!-- Home Page -->
<section class="pages bg-light mt-5" id="home">
    <form action="/rich_text_editor" id="first_form" method="POST">
        <label for="myTextarea">Sample
        </label>
        <textarea id="myTextarea" name="description"> </textarea>
        <button class="btn btn-danger" id="btnText" type="submit">Submit</button>
    </form>
</section>

<section>
    <div class="container">
        <span id="value"></span>
    </div>
</section>

<script>

    tinymce.init({
        selector: 'textarea',  // change this value according to your HTML
        height: 300,
        plugins: ['a11ychecker', 'advcode', 'advtable', 'anchor', 'autocorrect',
            'autosave', 'editimage', 'linkchecker', 'media', 'mediaembed', 'pageembed',
            'powerpaste', 'searchreplace', 'table', 'template', 'tinymcespellchecker', 'typography', 'visualblocks', 'wordcount',
            'advlist', 'autolink', 'link', 'image', 'lists', 'charmap', 'preview', 'anchor', 'pagebreak',
            'searchreplace', 'wordcount', 'visualblocks', 'code', 'fullscreen', 'insertdatetime', 'media',
            'table', 'emoticons', 'template', 'help'
        ],
        toolbar: 'undo redo | styles | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | ' +
            'bullist numlist outdent indent | table link image media pageembed  | print preview media fullscreen | ' +
            'forecolor backcolor emoticons | spellcheckdialog a11ycheck typography code | help',
        menu: {
            favs: {title: 'My Favorites', items: 'code visualaid | searchreplace | emoticons'}
        },
        menubar: 'favs file edit view insert format tools table help',
        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:16px }',
        browser_spellcheck: true,
        contextmenu: false,
        a11ychecker_level: 'aaa',
        typography_langs: ['en-US'],
        typography_default_lang: 'en-US',
        advcode_inline: true,
        image_advtab: true,
        images_upload_handler: function (blobInfo, success, failure) {
            let reader = new FileReader();
            reader.onload = function (e) {
                success(e.target.result);
            };
            reader.readAsDataURL(blobInfo.blob());
        },
        setup: function (editor) {
            editor.on("change", function () {
                calculateSize();
            });
        },

    });

    function calculateSize() {
        let editorContent = tinymce.activeEditor.getContent();
        let tempElement = document.createElement("div");
        tempElement.innerHTML = editorContent;

        let images = tempElement.querySelectorAll("img");
        let videos = tempElement.querySelectorAll("video");
        let htmlSizeInBytes = editorContent.length * 2; // Each character is 2 bytes in JavaScript
        let totalSizeInBytes = htmlSizeInBytes;

        for (let i = 0; i < images.length; i++) {
            let image = images[i];
            let base64Data = getImageBase64Data(image.src);
            let imageSizeInBytes = calculateBase64DataSize(base64Data);
            totalSizeInBytes += imageSizeInBytes;
        }

        for (let j = 0; j < videos.length; j++) {
            let video = videos[j];
            let videoSizeInBytes = getVideoSize(video.src);
            totalSizeInBytes += videoSizeInBytes;
        }

        let totalSizeInMB = (totalSizeInBytes / (1024 * 1024)).toFixed(2);
        console.log("Total Size: " + totalSizeInMB + " MB");
        $("#value").html("Total Size: " + totalSizeInBytes + " B \n Total Size: " + totalSizeInMB + " MB");
    }

    function getImageBase64Data(url) {
        // Extract base64 data from the image URL
        let base64Data = url.split(",")[1];
        return base64Data;
    }

    function calculateBase64DataSize(base64Data) {
        // Convert base64 data to raw binary data
        let binaryData = atob(base64Data);

        // Get the length of the binary data in bytes
        let sizeInBytes = binaryData.length;

        return sizeInBytes;
    }

    function getVideoSize(url) {
        // Make an AJAX request to retrieve the video size
        let xhr = new XMLHttpRequest();
        xhr.open("HEAD", url, false);
        xhr.send();
        let size = parseInt(xhr.getResponseHeader("Content-Length"));
        return size;
    }
</script>


</body>

</html>